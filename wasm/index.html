<html>
    <head>
        <link rel="stylesheet" type="text/css" href="main.css"/>
        <script src="wasm_exec.js"></script>
        <script>
            const go = new Go();
            WebAssembly.instantiateStreaming(fetch("decode.wasm"), go.importObject)
                .then(result => {
                go.run(result.instance);
            });
        </script>
    </head>
    <body style="text-align-last: center">
        <div>
            <textarea id="input" cols="40" rows="10">
            </textarea>
        </div>
        <div>
            <input type="submit"
                   value="> decode Encode <"
                   onclick="asyncDecode(input.value)"/>
        </div>
        <div>
            <textarea id="output" cols="40" rows="10">
            </textarea>
        </div>
        <div>
            <input type="submit"
                   value="> show all records <"
                   onclick="asyncRecords()"/>
        </div>
        <div>
            <div id="records"></div>
        </div>
    </body>
    <script>
        async function asyncDecode(input) {
            try {
                var password = prompt("Enter the password")
                const response = await decode(input, password);
                const data = await response.json();
                // console.log(data);
                output.value = "login: " + data.Map.Login + "password:" + data.Map.Password;
            } catch (err) {
                console.error('Caught exception', err)
            }
        }
        async function asyncRecords() {
            try {
                var password = prompt("Enter the password")
                const response = await records(password);
                const data = await response.json();
                var ul = document.createElement('ul');
                ul.setAttribute('class','records');
                document.getElementById('records').appendChild(ul);
                for (let key in data) {
                    let rec = data[key];
                    var li = document.createElement('li');
                    li.setAttribute('class','item');
                    ul.appendChild(li);
                    li.innerHTML=li.innerHTML + rec.Login + '<br/>' + rec.URL;
                    //console.log(rec.Login);
                }
                // console.log(data);
                output.value = JSON.stringify(data)
            } catch (err) {
                console.error('Caught exception', err)
            }
        }
    </script>
</html>
